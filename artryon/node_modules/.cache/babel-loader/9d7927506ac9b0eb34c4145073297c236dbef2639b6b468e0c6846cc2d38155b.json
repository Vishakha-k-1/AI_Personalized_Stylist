{"ast":null,"code":"var _jsxFileName = \"/workspaces/AI_Personalized_Stylist/artryon/src/components/ARTryOn.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport * as THREE from \"three\";\nimport { Canvas } from \"@react-three/fiber\";\nimport { useGLTF } from \"@react-three/drei\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport * as mpPose from \"@mediapipe/pose\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Model = ({\n  url\n}) => {\n  _s();\n  const {\n    scene\n  } = useGLTF(url);\n  return /*#__PURE__*/_jsxDEV(\"primitive\", {\n    object: scene\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 10,\n    columnNumber: 10\n  }, this);\n};\n_s(Model, \"o+hqw2nGnmzAsiWsKcbG4W2mWg4=\", false, function () {\n  return [useGLTF];\n});\n_c = Model;\nconst ARTryOn = ({\n  selectedModel\n}) => {\n  _s2();\n  const [poseData, setPoseData] = useState(null);\n  const [modelUrl, setModelUrl] = useState(selectedModel);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const videoWidth = 640;\n  const videoHeight = 480;\n  const [model, setModel] = useState(null);\n  const loadModel = url => {\n    const loader = new GLTFLoader();\n    loader.load(url, gltf => {\n      setModel(gltf.scene);\n    });\n  };\n  useEffect(() => {\n    if (selectedModel) {\n      loadModel(selectedModel);\n    }\n  }, [selectedModel]);\n\n  // Setup MediaPipe Pose\n  useEffect(() => {\n    const videoElement = videoRef.current;\n    const pose = new mpPose.Pose({\n      locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@${mpPose.VERSION}/${file}`\n    });\n    pose.onResults(results => {\n      if (results.poseLandmarks) {\n        setPoseData(results.poseLandmarks);\n      }\n    });\n    const startCamera = async () => {\n      await navigator.mediaDevices.getUserMedia({\n        video: true\n      }).then(stream => {\n        videoElement.srcObject = stream;\n        videoElement.play();\n\n        // Wait for the video element to start playing before sending frames\n        videoElement.onplaying = () => {\n          const sendFrame = async () => {\n            const frame = videoElement; // Use the video element directly\n            pose.send({\n              image: frame\n            });\n          };\n\n          // Call sendFrame in a loop, e.g., every 100ms\n          const frameInterval = setInterval(() => {\n            sendFrame();\n          }, 100);\n\n          // Cleanup on component unmount\n          return () => clearInterval(frameInterval);\n        };\n      }).catch(error => {\n        console.error(\"Error accessing webcam:\", error);\n      });\n    };\n    startCamera();\n    return () => {\n      if (videoElement.srcObject) {\n        videoElement.srcObject.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, []);\n  const calculateScale = poseData => {\n    if (!poseData) return 1;\n    const shoulderWidth = Math.abs(poseData[11].x - poseData[12].x); // Left and right shoulder\n    const chestHeight = Math.abs(poseData[23].y - poseData[24].y); // Upper body height\n    const scale = shoulderWidth * chestHeight * 2; // Adjust scaling factor based on pose\n\n    return scale;\n  };\n  const scaleOutfit = () => {\n    if (model && poseData) {\n      const scale = calculateScale(poseData);\n      model.scale.set(scale, scale, scale);\n    }\n  };\n  useEffect(() => {\n    scaleOutfit();\n  }, [poseData, model]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"relative\",\n      width: \"100%\",\n      height: \"100vh\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      style: {\n        position: \"absolute\",\n        top: \"0\",\n        left: \"0\",\n        zIndex: \"1\",\n        width: \"100%\"\n      },\n      width: videoWidth,\n      height: videoHeight,\n      autoPlay: true,\n      muted: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Canvas, {\n      style: {\n        width: \"100%\",\n        height: \"100%\",\n        position: \"absolute\"\n      },\n      gl: {\n        antialias: true\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"ambientLight\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"spotLight\", {\n        position: [10, 10, 10]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this), model && /*#__PURE__*/_jsxDEV(\"primitive\", {\n        object: model\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 5\n  }, this);\n};\n_s2(ARTryOn, \"YS+r7ECFLkvEGoj5O8z7b/YzJnY=\");\n_c2 = ARTryOn;\nexport default ARTryOn;\nvar _c, _c2;\n$RefreshReg$(_c, \"Model\");\n$RefreshReg$(_c2, \"ARTryOn\");","map":{"version":3,"names":["React","useState","useEffect","useRef","THREE","Canvas","useGLTF","GLTFLoader","mpPose","jsxDEV","_jsxDEV","Model","url","_s","scene","object","fileName","_jsxFileName","lineNumber","columnNumber","_c","ARTryOn","selectedModel","_s2","poseData","setPoseData","modelUrl","setModelUrl","videoRef","canvasRef","videoWidth","videoHeight","model","setModel","loadModel","loader","load","gltf","videoElement","current","pose","Pose","locateFile","file","VERSION","onResults","results","poseLandmarks","startCamera","navigator","mediaDevices","getUserMedia","video","then","stream","srcObject","play","onplaying","sendFrame","frame","send","image","frameInterval","setInterval","clearInterval","catch","error","console","getTracks","forEach","track","stop","calculateScale","shoulderWidth","Math","abs","x","chestHeight","y","scale","scaleOutfit","set","style","position","width","height","children","ref","top","left","zIndex","autoPlay","muted","gl","antialias","_c2","$RefreshReg$"],"sources":["/workspaces/AI_Personalized_Stylist/artryon/src/components/ARTryOn.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport * as THREE from \"three\";\nimport { Canvas } from \"@react-three/fiber\";\nimport { useGLTF } from \"@react-three/drei\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport * as mpPose from \"@mediapipe/pose\";\n\nconst Model = ({ url }) => {\n  const { scene } = useGLTF(url);\n  return <primitive object={scene} />;\n};\n\nconst ARTryOn = ({ selectedModel }) => {\n  const [poseData, setPoseData] = useState(null);\n  const [modelUrl, setModelUrl] = useState(selectedModel);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  const videoWidth = 640;\n  const videoHeight = 480;\n\n  const [model, setModel] = useState(null);\n\n  const loadModel = (url) => {\n    const loader = new GLTFLoader();\n    loader.load(url, (gltf) => {\n      setModel(gltf.scene);\n    });\n  };\n\n  useEffect(() => {\n    if (selectedModel) {\n      loadModel(selectedModel);\n    }\n  }, [selectedModel]);\n\n  // Setup MediaPipe Pose\n  useEffect(() => {\n    const videoElement = videoRef.current;\n    const pose = new mpPose.Pose({\n      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@${mpPose.VERSION}/${file}`,\n    });\n\n    pose.onResults((results) => {\n      if (results.poseLandmarks) {\n        setPoseData(results.poseLandmarks);\n      }\n    });\n\n    const startCamera = async () => {\n      await navigator.mediaDevices.getUserMedia({\n        video: true,\n      }).then((stream) => {\n        videoElement.srcObject = stream;\n        videoElement.play();\n    \n        // Wait for the video element to start playing before sending frames\n        videoElement.onplaying = () => {\n          const sendFrame = async () => {\n            const frame = videoElement; // Use the video element directly\n            pose.send({ image: frame });\n          };\n    \n          // Call sendFrame in a loop, e.g., every 100ms\n          const frameInterval = setInterval(() => {\n            sendFrame();\n          }, 100);\n    \n          // Cleanup on component unmount\n          return () => clearInterval(frameInterval);\n        };\n      }).catch((error) => {\n        console.error(\"Error accessing webcam:\", error);\n      });\n    };\n    \n    startCamera();\n\n    return () => {\n      if (videoElement.srcObject) {\n        videoElement.srcObject.getTracks().forEach((track) => track.stop());\n      }\n    };\n  }, []);\n\n  const calculateScale = (poseData) => {\n    if (!poseData) return 1;\n\n    const shoulderWidth = Math.abs(poseData[11].x - poseData[12].x); // Left and right shoulder\n    const chestHeight = Math.abs(poseData[23].y - poseData[24].y); // Upper body height\n    const scale = shoulderWidth * chestHeight * 2; // Adjust scaling factor based on pose\n\n    return scale;\n  };\n\n  const scaleOutfit = () => {\n    if (model && poseData) {\n      const scale = calculateScale(poseData);\n      model.scale.set(scale, scale, scale);\n    }\n  };\n\n  useEffect(() => {\n    scaleOutfit();\n  }, [poseData, model]);\n\n  return (\n    <div style={{ position: \"relative\", width: \"100%\", height: \"100vh\" }}>\n      <video\n        ref={videoRef}\n        style={{ position: \"absolute\", top: \"0\", left: \"0\", zIndex: \"1\", width: \"100%\" }}\n        width={videoWidth}\n        height={videoHeight}\n        autoPlay\n        muted\n      />\n      <Canvas style={{ width: \"100%\", height: \"100%\", position: \"absolute\" }} gl={{ antialias: true }}>\n        <ambientLight />\n        <spotLight position={[10, 10, 10]} />\n        {model && <primitive object={model} />}\n      </Canvas>\n    </div>\n  );\n};\n\nexport default ARTryOn;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}